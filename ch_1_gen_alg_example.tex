\subsection{Применение генетического алгоритма в задачах оптимизации}
\label{sec:1d}

Генетические алгоритмы применяются для решения большого круга задач.
Примерами являются разнообразные задачи на графах (задача коммивояжера, раскраска и т.д.),
задачи биоинформатики, игровые стратегии, настройка и обучение искусственной нейронной сети.
Также генетические алгоритмы могут быть использованы для оптимизации функций.

Рассмотрим подробно работу генетического алгоритма для нахождения максимума функции на
примере, описанном в \cite{Rotshtein1999}.

Целевая функция представляет собой нелинейную функцию с ограничениями:

\begin{equation}
  \left \{
    \begin{array}{ll}
    f(x_{1}, x_{2}) = (-2x_{2}^{3} + 6x_{2}^{2} + 6x_{2} + 10) \cdot sin(ln(x_{1})\cdot e^{x_{2}}) \\
    0.5 \leq x_{1} \leq 1.1 \\
    1.0 \leq x_{2} \leq 4.6
    \end{array}
  \right .
\end{equation}

Требуется найти: $\max\limits_{x_{1}, x_{2}} f(x_1, x_2)$.

График функции $f(x)$ изображен на рис.~\ref{gen_example_pic}.

\begin{figure}[ht!]
\centering
  \includegraphics[trim=30 100 30 330, clip, width=0.8\textwidth]{./FIGs/gen_example.pdf}
\caption{График целевой функции}
\label{gen_example_pic}
\end{figure}


В предложенной реализации оптимизируемые параметры закодированы в виде двоичных строк. Длина строки
зависит от требуемой точности. Например, пусть переменная $x_{j}$ имеет интервал изменения $[a_j, b_j]$,
и требуемая точность~-- пять знаков после запятой. В этом случае интервал изменения переменной $x_j$
должен быть разбит как минимум на $(b_j - a_j) \times 10^{5}$ квантов.

Требуемое число бит находится по формуле:
\begin{equation}
  2^{m_j -1} < (b_j - a_j) \times 10^{5} \leq 2_{m_j} -1
\end{equation}

Обратное преобразование строки битов в действительное значение переменной $x_j$ выполняется по
следующей формуле:

\begin{equation}
  x_j = a_j + d(s_j) \times \frac{b_j - a_j}{2^{m_j} - 1},
\end{equation}

где $d(s_j)$ представляет собой десятичное значение, закодированное в бинарной строке $s_j$.

Предположим, что требуемая точность составляет 5 знаков после запятой, тогда число битов,
необходимых для кодирования переменных $x_1$ и $x_2$ составят 16 ($m_1$) и 19 ($m_2$) соответственно.
Суммарная длина хромосомы: $m=m_1+m_2 = 35$.

Исходная популяция генерируется случайным образом:

\begin{equation*}
  \begin{array}{l}
  v_1 = [01000001010100101001101111011111110] \\
  v_2 = [10001110101110011000000010101001000] \\
  v_3 = [11111000111000001000010101001000110] \\
  v_4 = [01100110110100101101000000010111001] \\
  v_5 = [00000010111101100010001110001101000] \\
  v_6 = [10111110101011011000000010110011001] \\
  v_7 = [00110100010011111000100110011101101] \\
  v_8 = [11001011010100001100010110011001100] \\
  v_9 = [01111110001011101100011101000111101] \\
  v_{10} = [01111101001110101010000010101101010]
  \end{array}
\end{equation*}

Оценка функции соответствия хромосомы в данном примере выполняется в три шага:
\begin{enumerate}
  \item{Преобразовать генотип хромосомы в фенотип. В данной задаче это означает преобразование двоичной
    строки в соответствующее действительное значение $x_{k} = (x_{1}^{k}, x_{2}^{k}), k = 1 \cdots N$, \\
    где $N$~-- число вариантов в исходной популяции.}
  \item{Вычислить целевую функцию $f(x^k)$}
  \item{Преобразовать целевую функцию в значение функции соответствия. Для решаемой задачи оптимизации 
    функция соответствия эквивалентна целевой функции: $eval(v_k) = f(x^k), k = 1 \cdots N$}
\end{enumerate}

Функция соответствия играет роль среды и оценивает хромосомы по степени их приспособленности к
выполнению критерия оптимизации. Значения функций приспособленности вышеприведенных хромосом
следующие:
\begin{equation*}
  \begin{array}{l}
    eval(v_1) = f(0.653097, 3.191983) = 20.432394 \\
    eval(v_2) = f(0.834511, 3.809287) = -4.133627 \\
    eval(v_3) = f(1.083310, 2.874312) = 28.978472 \\
    eval(v_4) = f(0.740989, 3.926276) = -2.415740 \\
    eval(v_5) = f(0.506940, 1.499934) = -2.496340 \\
    eval(v_6) = f(0.946903, 2.809843) = -23.503709 \\
    eval(v_7) = f(0.622600, 2.935225) = -13.878172 \\
    eval(v_8) = f(0.976521, 3.778750) = -8.996062 \\
    eval(v_9) = f(0.795738, 3.802377) = 6.982708 \\
    eval(v_{10}) = f(0.793504, 3.259521) = 6.201905 \\
  \end{array}
\end{equation*}

Очевидно, что хромосома $v_3$ наиболее сильная, а хромосома $v_6$ наиболее слабая.

В данном примере для отбора хромосом в следующее поколение используется подход, называемый
{\it колесо рулетки} (от англ. roulette wheel). Согласно этому подходу отбор осуществляется на основе
некоторой функции распределения, которая строится пропорционально вычисленным функциям соответствия
сгенерированных вариантов-хромосом. Колесо рулетки может быть сконструировано следующим образом:

\begin{enumerate}
  \item{Вычисляется значение функции соответствия $eval(v_k)$ для каждой хромосомы $v_k$:
      \begin{equation}
        eval(v_k) = f(x^k), k = 1 \cdots N.
      \end{equation}
    }
  \item{Вычисляется общая функция соответствия популяции:
      \begin{equation}
        F = \sum_{k=1}^{N}(eval(v_k) - \min\limits_{j=1,N}{eval(v_j)})
      \end{equation}
    }
  \item{Вычисляется вероятность отбора $p_k$ для каждой хромосомы $v_k$:
      \begin{equation}
        p_k = \frac{eval(v_k) - \min\limits_{j=1,N}{eval(v_j)}}{F}, k = 1 \cdots N.
      \end{equation}
    }
  \item{Вычисляется совокупная вероятность $q_k$ для каждой хромосомы $v_k$:
      \begin{equation}
        q_k = \sum_{j=1}^{k}{p_j},  k = 1 \cdots N.
      \end{equation}
    }
\end{enumerate}

Процесс отбора начинается с вращения колеса $N$ раз; при этом каждый раз выбирается
одна хромосома по следующему алгоритму:

\begin{enumerate}
  \item{Генерируется случайное число $r$ из интервала $[0,1]$.}
  \item{Если $r \leq q_1$, то выбирается первая хромосома $v_1$; иначе выбирается $k$-ая хромосома такая, что
    $q_{k-1} < r \leq q_k$}.
\end{enumerate}

Общая функция соответствия $F$ всей популяции равна:
\begin{equation*}
  F = \sum_{k=1}^{10}(eval(v_k) - \min\limits_{j=1,10}{eval(v_j)}) = 242.208919
\end{equation*}

Вероятность $p_k$ для каждой хромосомы $v_k$ равна:
\begin{equation*}
  \begin{array}{lll}
    p_1 = 0.181398 & p_2 = 0.079973 & p_3 = 0.216681 \\
    p_4 = 0.087065 & p_5 = 0.086732 & p_6 = 0.000000 \\
    p_7 = 0.039741 & p_8 = 0.059897 & p_9 = 0.125868 \\
    p_{10} = 0.122645
  \end{array}
\end{equation*}

Совокупные вероятности $q_k$ для каждой хромосомы $v_k$ равны:

\begin{equation*}
  \begin{array}{lll}
    q_1 = 0.181398 & q_2 = 0.261370 & q_3 = 0.478025 \\
    q_4 = 0.565117 & q_5 = 0.651849 & q_6 = 0.651849 \\
    q_7 = 0.691590 & q_8 = 0.751487 & q_9 = 0.877355 \\
    q_{10} = 1.000000
  \end{array}
\end{equation*}

Следующим шагом отбора является вращение колеса рулетки 10 раз и каждый раз отбирается одна
хромосома для новой популяции. Допустим, что случайная последовательность 10 чисел из
интервала $[0,1]$ имеет вид:

\begin{equation*}
  \begin{array}{llll}
    0.301431 & 0.322062 & 0.766503 & 0.881893 \\
    0.350871 & 0.583392 & 0.177618 & 0.343242 \\
    0.032685 & 0.195577
  \end{array}
\end{equation*}

Первое число $r_1$ больше, чем $q_2$ и меньше, чем $q_3$. Это означает, что отбирается хромосома $v_3$.
Второе число $r_2$ также больше, чем $q_2$ и меньше, чем $q_3$. Вновь отбирается хромосома $v_3$ для новой
популяции; и т.д. Таким образом формируется новая популяция, состоящая из следующих хромосом:
\begin{equation*}
  \begin{array}{l}
    v_{1}' = [11111000111000001000010101001000110] (v_3)
    v_{2}' = [11111000111000001000010101001000110] (v_3)
    v_{3}' = [11001011010100001100010110011001100] (v_8)
    v_{4}' = [01111110001011101100011101000111101] (v_9)
    v_{5}' = [11111000111000001000010101001000110] (v_3)
    v_{6}' = [01100110110100101101000000010111001] (v_4)
    v_{7}' = [01000001010100101001101111011111110] (v_1)
    v_{8}' = [11111000111000001000010101001000110] (v_3)
    v_{9}' = [01000001010100101001101111011111110] (v_1)
    v_{10}' = [10001110101110011000000010101001000] (v_2)
  \end{array}
\end{equation*}

Для скрещивания хромосом в этом примере используется метод с одной точкой обмена.
В соответствии с этим методом, случайно выбирается одна точка обмена, относительно
которой меняются местами части хромосом-родителей.

Пусть вероятность скрещивания $p_c = 0.25$, т.е. в среднем $25\%$ хромосом подвергаются
скрещиванию. Для того, чтобы определить родителей для скрещивания генерируется случайная
последовательность из $N$ элементов в диапазоне $[0,1]$ и выбираются те, которые меньше $p_c$.
Пусть сгенерирована следующая последовательность случайных чисел:

\begin{equation*}
  \begin{array}{llll}
    0.625721 & 0.266823 & 0.288644 & 0.295114 \\
    0.163274 & 0.567461 & 0.085940 & 0.392862 \\
    0.770714 & 0.548656
  \end{array}
\end{equation*}

По результатам полученной последовательности хромосомы $v_{5}'$ и $v_{7}'$ выбираются
для скрещивания. После этого генерируется случайное число $pos$ (позиция) из промежутка
$[1,34]$ (так как общая длина хромосомы равна 35), которое принимается за точку скрещивания.
Предположим, что было сгенерировано число $pos$ равное 1, т.е. хромосомы-родители обмениваются
частями после первого бита и при этом появляются следующие хромосомы-отпрыски:

\begin{equation*}
  \begin{array}{l}
    v_{5}' = \colorbox{Gray}{[11111000111000001000010101001000110]} \\
    v_{7}' = [01000001010100101001101111011111110] \\
    \Downarrow \\
    v_{5}' = \colorbox{Gray}{[1}1000001010100101001101111011111110] \\
    v_{7}' = [0~\colorbox{Gray}{1111000111000001000010101001000110]}
  \end{array}
\end{equation*}

Мутация в данном примере состоит в изменении одного или большего числа генов с вероятностью,
равной коэффициенту мутации. Так как хромосомы представлены в виде бинарных строк, то
мутация заключается в инверсии соответствующего бита.

Пусть коэффициент мутации $p_m = 0.01$, тогда в среднем $1\%$ всех битов популяции будет
подвергаться операции мутации. Число битов во всей популяции составляет
$m \times N = 35 \times 10 = 350$ битов. Поэтому в среднем в каждом поколении мутирует
3.5 бита. Каждый бит имеет одинаковый шанс подвергнуться мутации. Для того, чтобы определить
мутирующие гены генерируется последовательность случайных чисел $r_k (k=1 \cdots 350)$
из интервала $[0,1]$. Предположим, что мутируют следующие гены:

\begin{center}
\begin{tabular}{|p{0.25\linewidth}|p{0.2\linewidth}|p{0.2\linewidth}|p{0.25\linewidth}|}
  \hline
  Позиция бита в популяции  & Номер хромосомы & Позиция бита в хромосоме & Случайное число $r_k$ \\
  \hline
  111                       & 4               & 6                        & 0.009857 \\
  \hline
  172                       & 5               & 32                       & 0.003113 \\
  \hline
  211                       & 7               & 1                        & 0.000946 \\
  \hline
  347                       & 10              & 32                       & 0.001282 \\
  \hline
\end{tabular}
\end{center}

После описанных мутаций значения функции и соответствующих переменных $x_{1}$ и $x_{2}$
имеют вид:

\begin{equation*}
  \begin{array}{l}
    f(1.083310, 2.874312) = 28.978472 \\
    f(1.083310, 2.874312) = 28.978472 \\
    f(0.976521, 3.778750) = -8.996062 \\
    f(0.786363, 3.802377) =  9.366723 \\
    f(0.953101, 3.191928) = -23.229745 \\
    f(0.740989, 3.926276) = -2.415740 \\
    f(1.083310, 2.874312) = 28.978472 \\
    f(1.083310, 2.874312) = 28.978472 \\
    f(0.653097, 3.191983) = 20.432394 \\
    f(0.834511, 2.809232) = -4.138564 \\
  \end{array}
\end{equation*}

Таким образом, завершена одна итерация генетического алгоритма.
В данном примере были проделаны 1000 итераций. Наилучшая хромосома была
получена в 419-м поколении:

\begin{equation*}
  \begin{array}{l}
    v^{*} = [01000011000100110110010011011101001]; \\
    eval(v^*) = f(0.657208, 2.418399) = 31.313555; \\
    x_{1}^* = 0.657208; \\
    x_{2}^* = 2.418399.
  \end{array}
\end{equation*}
